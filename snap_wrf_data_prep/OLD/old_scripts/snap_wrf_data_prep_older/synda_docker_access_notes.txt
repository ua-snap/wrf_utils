mkdir -p /workspace/Shared/Tech_Projects/DeltaDownscaling/project_data/cmip5_nwt/data
mkdir -p /workspace/Shared/Tech_Projects/DeltaDownscaling/project_data/cmip5_nwt/db
mkdir -p /workspace/Shared/Tech_Projects/DeltaDownscaling/project_data/cmip5/sandbox


# DOCKER PHOBOS:
screen docker daemon # then ctrl-a, ctrl-d to get out of the screen 

# set up local dirs...
mkdir -p ~/synda/sdt/conf
wget -O ~/synda/sdt/conf/sdt.conf https://github.com/Prodiguer/synda/raw/master/sdt/conf/sdt.conf
wget -O ~/synda/sdt/conf/credentials.conf https://github.com/Prodiguer/synda/raw/master/sdt/conf/credentials.conf
vi ~/synda/sdt/conf/credentials.conf

# set the config stuff up we want:
# # INTO THE sdt.conf file...
data_path=/workspace/Shared/Tech_Projects/DeltaDownscaling/project_data/cmip5_nwt/data
db_path=/workspace/Shared/Tech_Projects/DeltaDownscaling/project_data/cmip5_nwt/db
sandbox_path=/workspace/Shared/Tech_Projects/DeltaDownscaling/project_data/cmip5/sandbox

# # INTO THE credentials file
[esgf_credential]
#openid=https://esgf-node.ipsl.upmc.fr/esgf-idp/openid/DataMonkey
#password=OpenSci 2017
#openid=https://pcmdi.llnl.gov/esgf-idp/openid/EarthScientist
#openid=https://esgf-data.dkrz.de/esgf-idp/openid/LearningToFly
#password=download123A*
#openid=https://esgf-node.llnl.gov/esgf-idp/openid/EarthScientist
#password=OpenData 2015
#openid=https://esgf-node.ipsl.upmc.fr/esgf-idp/openid/DataMonkey
#password="OpenSci 2017"

# # ADD TO the selection file to the new selection repo...
project=CMIP5
model=MRI-CGCM3 GISS-E2-R GFDL-CM3 IPSL-CM5A-LR CCSM4 
experiment=historical rcp26 rcp45 rcp60 rcp85
ensemble=r1i1p1
variable[atmos][mon]=tas pr
timeslice=210001-230012

# start up the docker container...
sudo docker run -d -t -i -v ~/synda/sdt/data/:/workspace/Shared/Tech_Projects/DeltaDownscaling/project_data/cmip5_nwt/data/ -v ~/synda/sdt/db/:/workspace/Shared/Tech_Projects/DeltaDownscaling/project_data/cmip5_nwt/db/ -v ~/synda/sdt/log/:/home/synda/sdt/log/ -v ~/synda/sdt/selection:/home/synda/sdt/selection/ -v ~/synda/sdt/conf/:/home/synda/sdt/conf/ -e UID=$UID -e GID=$GROUPS prodiguer/synda /bin/bash

# find what the container id is:
sudo docker ps
sudo docker attach 302396530be3

# now install the datasets...

complete  cmip5.output1.NCAR.CCSM4.rcp45.mon.atmos.Amon.r1i1p1.v20121031
complete  cmip5.output1.NCAR.CCSM4.rcp60.mon.atmos.Amon.r1i1p1.v20130312
complete  cmip5.output1.NCAR.CCSM4.rcp85.mon.atmos.Amon.r1i1p1.v20130219
complete  cmip5.output1.NASA-GISS.GISS-E2-R.rcp85.mon.atmos.Amon.r1i1p1.v20121016
complete  cmip5.output1.NASA-GISS.GISS-E2-R.rcp45.mon.atmos.Amon.r1i1p1.v20121016
complete  cmip5.output1.NCAR.CCSM4.rcp60.mon.atmos.Amon.r1i1p1.v20130426
complete  cmip5.output1.NCAR.CCSM4.rcp85.mon.atmos.Amon.r1i1p1.v20130426
complete  cmip5.output1.NCAR.CCSM4.rcp45.mon.atmos.Amon.r1i1p1.v20130426
complete  cmip5.output1.NASA-GISS.GISS-E2-R.rcp85.mon.atmos.Amon.r1i1p1.v20160513
complete  cmip5.output1.NASA-GISS.GISS-E2-R.rcp45.mon.atmos.Amon.r1i1p1.v20160803
complete  cmip5.output1.NOAA-GFDL.GFDL-CM3.rcp45.mon.atmos.Amon.r1i1p1.v20120227
complete  cmip5.output1.NCAR.CCSM4.rcp45.mon.atmos.Amon.r1i1p1.v20160829
complete  cmip5.output1.NCAR.CCSM4.rcp60.mon.atmos.Amon.r1i1p1.v20160829
complete  cmip5.output1.NCAR.CCSM4.rcp85.mon.atmos.Amon.r1i1p1.v20160829

# split files to a dataframe to see what we got...
def split_fn( fn ):
    import os
    dirname, basename = os.path.split( fn )
    basename, ext = os.path.splitext( basename )
    variable, cmor_table, model, scenario, experiment, years = basename.split('_')
    begin_year, end_year = years.split( '-' )
    begin_year, begin_month = begin_year[:4], begin_year[-2:]
    end_year, end_month = end_year[:4], end_year[-2:]
    return {'variable':variable, 'cmor_table':cmor_table, 'model':model, 'scenario':scenario, 'experiment':experiment, 'begin_year':int(begin_year), 'begin_month':int(begin_month), 'end_year':int(end_year), 'end_month':int(end_month)}

def split_to_df( files ):
    return pd.DataFrame([ split_fn(fn) for fn in files])


    model           scenario    variable(s)  
    -----           --------    -----------
    GFDL-CM3        rcp45       tas, pr
    NCAR-CCSM4      rcp45       tas, pr
                    rcp60       tas, pr
                    rcp85       tas, pr
    GISS-E2-R       rcp45       tas, pr
                    rcp85       tas, pr
    IPSL-CM5A-LR    rcp45       tas, pr
                    rcp85       tas, pr

0   IPSL-CM5A-LR    rcp45       pr
6   IPSL-CM5A-LR    rcp85      tas
7   IPSL-CM5A-LR    rcp85       pr
11  IPSL-CM5A-LR    rcp45      tas
1       GFDL-CM3    rcp45       pr
2          CCSM4    rcp60       pr
3      GISS-E2-R    rcp85      tas
4       GFDL-CM3    rcp45      tas
5          CCSM4    rcp85       pr
8          CCSM4    rcp45       pr
9      GISS-E2-R    rcp85       pr
10         CCSM4    rcp60      tas
12     GISS-E2-R    rcp45      tas
13         CCSM4    rcp45      tas
14         CCSM4    rcp85      tas
15     GISS-E2-R    rcp45       pr